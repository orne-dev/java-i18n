<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>I18nResourcesString.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Orne I18N</a> &gt; <a href="index.source.html" class="el_package">dev.orne.i18n</a> &gt; <span class="el_source">I18nResourcesString.java</span></div><h1>I18nResourcesString.java</h1><pre class="source lang-java linenums">package dev.orne.i18n;

/*-
 * #%L
 * Orne I18N
 * %%
 * Copyright (C) 2021 Orne Developments
 * %%
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Lesser Public License for more details.
 * 
 * You should have received a copy of the GNU General Lesser Public
 * License along with this program.  If not, see
 * &lt;http://www.gnu.org/licenses/lgpl-3.0.html&gt;.
 * #L%
 */

import java.io.Serializable;
import java.text.MessageFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Locale;

import javax.validation.constraints.NotNull;
import javax.xml.bind.annotation.adapters.XmlJavaTypeAdapter;

import org.apache.commons.lang3.Validate;
import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.apiguardian.api.API;
import org.apiguardian.api.API.Status;

import com.fasterxml.jackson.databind.JsonDeserializer;
import com.fasterxml.jackson.databind.annotation.JsonDeserialize;

import dev.orne.i18n.jaxb.I18nResourcesStringAdapter;

/**
 * Implementation of {@code I18nString} based on {@code I18nResources}.
 * &lt;p&gt;
 * The class supports providing arguments to be used when computing the
 * resulting texts for the different languages.
 * As the I18N resources formatting depends of the underlying implementation
 * the default text will be formatted with {@code MessageFormat} passing the
 * configured arguments, if any.
 * 
 * @author &lt;a href=&quot;https://github.com/ihernaez&quot;&gt;(w) Iker Hernaez&lt;/a&gt;
 * @version 1.0, 2021-01
 * @since 0.1
 * @see MessageFormat
 */
@API(status=Status.STABLE, since=&quot;0.1&quot;)
@JsonDeserialize(using=JsonDeserializer.None.class)
@XmlJavaTypeAdapter(I18nResourcesStringAdapter.class)
public class I18nResourcesString
implements I18nString {

    /** The serial version UID. */
    private static final long serialVersionUID = 1L;

    /** The key of the I18N resources to use. */
    private final String i18nResourcesKey;
    /** The default text. */
    private final @NotNull String defaultText;
    /** The I18N text codes, in order of priority. */
    private final @NotNull String[] codes;
    /** The text arguments, applied to resolved text or default text. */
    private final @NotNull Serializable[] arguments;

    /**
     * Creates a new instance.
     * 
     * @param resources The I18N resources to use. If {@code null} will use
     * default ones
     * @param defaultMessage The default text
     * @param codes The I18N text codes, in order of priority
     * @param arguments The text arguments, applied to resolved text or
     * default text
     */
    public I18nResourcesString(
            final String resources,
            final @NotNull String defaultMessage,
            final @NotNull String[] codes,
            final Serializable... arguments) {
<span class="fc" id="L93">        super();</span>
<span class="fc" id="L94">        this.i18nResourcesKey = resources;</span>
<span class="fc" id="L95">        this.defaultText = Validate.notNull(defaultMessage);</span>
<span class="fc" id="L96">        Validate.notNull(codes);</span>
<span class="fc" id="L97">        Validate.noNullElements(codes);</span>
<span class="fc" id="L98">        this.codes = Arrays.copyOf(codes, codes.length);</span>
<span class="fc" id="L99">        Validate.notNull(arguments);</span>
<span class="fc" id="L100">        this.arguments = Arrays.copyOf(arguments, arguments.length);</span>
<span class="fc" id="L101">    }</span>

    /**
     * Creates a builder of a new instance with the specified default
     * text.
     * &lt;p&gt;
     * The text will be formatted with {@code MessageFormat} passing the
     * configured arguments. 
     * 
     * @param defaultMessage The default text
     * @return The new instance builder
     * @see MessageFormat
     */
    public static Builder forDefault(
            final @NotNull String defaultMessage) {
<span class="fc" id="L116">        return new Builder(defaultMessage);</span>
    }

    /**
     * Returns the key of the I18N resources to use.
     * If {@code null} default ones will be used.
     * 
     * @return The key of the I18N resources to use
     */
    public String getI18nResourcesKey() {
<span class="fc" id="L126">        return this.i18nResourcesKey;</span>
    }

    /**
     * Returns the unformatted default text.
     * 
     * @return The unformatted default text
     */
    public @NotNull String getDefaultText() {
<span class="fc" id="L135">        return this.defaultText;</span>
    }

    /**
     * Returns the formatted default text.
     * 
     * @return The formatted default text
     */
    public @NotNull String getFormattedDefaultText() {
        try {
<span class="fc" id="L145">            return MessageFormat.format(this.defaultText, (Object[]) this.arguments);</span>
<span class="fc" id="L146">        } catch (final IllegalArgumentException ignore) {</span>
<span class="fc" id="L147">            return this.defaultText;</span>
        }
    }

    /**
     * Returns the I18N text codes, in order of priority.
     * 
     * @return The I18N text codes
     */
    public @NotNull String[] getCodes() {
<span class="fc" id="L157">        return Arrays.copyOf(this.codes, this.codes.length);</span>
    }

    /**
     * Returns the text arguments, applied to resolved text or default
     * text.
     * 
     * @return The text arguments
     */
    public @NotNull Serializable[] getArguments() {
<span class="fc" id="L167">        return Arrays.copyOf(this.arguments, this.arguments.length);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public String get() {
<span class="fc" id="L175">        return I18N.getResources(this.i18nResourcesKey).getMessage(</span>
                this.defaultText,
                this.codes,
                (Object[]) this.arguments);
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public String get(final @NotNull String language) {
<span class="fc" id="L186">        return I18N.getResources(this.i18nResourcesKey).getMessage(</span>
                this.defaultText,
                this.codes,
<span class="fc" id="L189">                new Locale(Validate.notNull(language)),</span>
                (Object[]) this.arguments);
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public String get(final @NotNull Locale locale) {
<span class="fc" id="L198">        return I18N.getResources(this.i18nResourcesKey).getMessage(</span>
                this.defaultText,
                this.codes,
<span class="fc" id="L201">                Validate.notNull(locale),</span>
                (Object[]) this.arguments);
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public int hashCode() {
<span class="fc" id="L210">        return new HashCodeBuilder()</span>
<span class="fc" id="L211">                .append(this.defaultText)</span>
<span class="fc" id="L212">                .append(this.codes)</span>
<span class="fc" id="L213">                .append(this.arguments)</span>
<span class="fc" id="L214">                .append(this.i18nResourcesKey)</span>
<span class="fc" id="L215">                .toHashCode();</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public boolean equals(final Object obj) {
<span class="fc bfc" id="L223" title="All 2 branches covered.">        if (obj == null) { return false; }</span>
<span class="fc bfc" id="L224" title="All 2 branches covered.">        if (this == obj) { return true; }</span>
<span class="fc bfc" id="L225" title="All 2 branches covered.">        if (!this.getClass().equals(obj.getClass())) { return false; }</span>
<span class="fc" id="L226">        final I18nResourcesString other = (I18nResourcesString) obj;</span>
<span class="fc" id="L227">        return new EqualsBuilder()</span>
<span class="fc" id="L228">                .append(this.defaultText, other.defaultText)</span>
<span class="fc" id="L229">                .append(this.codes, other.codes)</span>
<span class="fc" id="L230">                .append(this.arguments, other.arguments)</span>
<span class="fc" id="L231">                .append(this.i18nResourcesKey, other.i18nResourcesKey)</span>
<span class="fc" id="L232">                .isEquals();</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public boolean isEquivalent(final I18nString obj) {
<span class="fc bfc" id="L240" title="All 2 branches covered.">        if (obj == null) { return false; }</span>
<span class="fc bfc" id="L241" title="All 2 branches covered.">        if (obj == this) { return true; }</span>
<span class="fc bfc" id="L242" title="All 2 branches covered.">        if (getClass().equals(obj.getClass())) { return equals(obj); }</span>
<span class="fc" id="L243">        return get().equals(obj.get());</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public @NotNull I18nStringMap asMap() {
<span class="fc" id="L251">        return new I18nStringMap(this.getFormattedDefaultText())</span>
<span class="fc" id="L252">                .set(I18N.getLocale(), get());</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public @NotNull String toString() {
<span class="fc" id="L260">        return getFormattedDefaultText();</span>
    }

    /**
     * Builder of {@code I18nResourcesString} instances. 
     * 
     * @author &lt;a href=&quot;https://github.com/ihernaez&quot;&gt;(w) Iker Hernaez&lt;/a&gt;
     * @version 1.0, 2021-01
     * @since 0.1
     */
    @API(status=Status.STABLE, since=&quot;0.1&quot;)
    public static class Builder {

        /** The key of the I18N resources to use. */
        private String i18nResourcesKey;
        /** The default text. */
        private final String defaultText;
        /** The I18N text codes, in order of priority. */
<span class="fc" id="L278">        private final List&lt;String&gt; codes = new ArrayList&lt;&gt;();</span>
        /** The text arguments, applied to resolved text or default text. */
<span class="fc" id="L280">        private final List&lt;Serializable&gt; arguments = new ArrayList&lt;&gt;();</span>

        /**
         * Creates a new {@code I18nResourcesString} builder with the specified
         * default text.
         * 
         * @param defaultText The default text
         */
        public Builder(final @NotNull String defaultText) {
<span class="fc" id="L289">            super();</span>
<span class="fc" id="L290">            this.defaultText = Validate.notNull(defaultText);</span>
<span class="fc" id="L291">        }</span>

        /**
         * Sets the I18N resources to use. If {@code null} will use
         * default ones.
         * 
         * @param key The I18N resources to use
         * @return This builder for method chaining
         */
        public Builder ofResources(final String key) {
<span class="fc" id="L301">            this.i18nResourcesKey = key;</span>
<span class="fc" id="L302">            return this;</span>
        }

        /**
         * Appends the specified text code to the codes configured of this
         * builder.
         * 
         * @param code The I18N text code
         * @return This builder for method chaining
         */
        public Builder withCode(final @NotNull String code) {
<span class="fc" id="L313">            this.codes.add(Validate.notNull(code));</span>
<span class="fc" id="L314">            return this;</span>
        }

        /**
         * Appends the specified text codes to the codes configured
         * of this builder. No {@code null} codes are allowed.
         * 
         * @param codes The I18N text codes, in order of priority
         * @return This builder for method chaining
         */
        public Builder withCodes(final @NotNull String... codes) {
<span class="fc" id="L325">            this.codes.addAll(Arrays.asList(Validate.noNullElements(codes)));</span>
<span class="fc" id="L326">            return this;</span>
        }

        /**
         * Adds the specified argument to the text arguments of this builder.
         * 
         * @param arg The text argument, applied to resolved or
         * default text
         * @return This builder for method chaining
         */
        public Builder withArg(final Serializable arg) {
<span class="fc" id="L337">            this.arguments.add(arg);</span>
<span class="fc" id="L338">            return this;</span>
        }

        /**
         * Adds the specified arguments to the text arguments of this builder.
         * 
         * @param args The text arguments, applied to resolved text or
         * default text
         * @return This builder for method chaining
         */
        public Builder withArgs(final Serializable... args) {
<span class="fc" id="L349">            this.arguments.addAll(Arrays.asList(args));</span>
<span class="fc" id="L350">            return this;</span>
        }

        /**
         * Returns the key of the I18N resources to use.
         * 
         * @return The key of the I18N resources to use
         */
        protected String getI18nResourcesKey() {
<span class="fc" id="L359">            return this.i18nResourcesKey;</span>
        }

        /**
         * Returns the default text.
         * 
         * @return The default text
         */
        protected String getDefaultText() {
<span class="fc" id="L368">            return this.defaultText;</span>
        }

        /**
         * Returns the I18N text codes, in order of priority.
         * 
         * @return The I18N text codes, in order of priority
         */
        protected List&lt;String&gt; getCodes() {
<span class="fc" id="L377">            return this.codes;</span>
        }

        /**
         * Returns the text arguments, applied to resolved or
         * default text.
         * 
         * @return The text arguments
         */
        protected List&lt;Serializable&gt; getArguments() {
<span class="fc" id="L387">            return this.arguments;</span>
        }

        /**
         * {@inheritDoc}
         */
        @Override
        public int hashCode() {
<span class="fc" id="L395">            return HashCodeBuilder.reflectionHashCode(this);</span>
        }

        /**
         * {@inheritDoc}
         */
        @Override
        public boolean equals(final Object obj) {
<span class="fc" id="L403">            return EqualsBuilder.reflectionEquals(this, obj);</span>
        }

        /**
         * Builds a {@code I18nResourcesString} with the configured properties.
         * Validates that the default text and that at least one text code
         * are set.
         * 
         * @return The {@code I18nResourcesString} with the configured
         * properties
         */
        public I18nResourcesString build() {
<span class="fc" id="L415">            Validate.notEmpty(codes);</span>
<span class="fc" id="L416">            return new I18nResourcesString(</span>
                    this.i18nResourcesKey,
                    this.defaultText,
<span class="fc" id="L419">                    codes.toArray(new String[0]),</span>
<span class="fc" id="L420">                    arguments.toArray(new Serializable[0]));</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>